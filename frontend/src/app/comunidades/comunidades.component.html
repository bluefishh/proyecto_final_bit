<header class="shadow-sm">
	<nav class="navbar navbar-expand-lg bg-white py-3">
		<div class="container-fluid px-4">
			<a class="navbar-brand d-flex align-items-center" href="#">
				<img src="CAS_without_bg_navbar.png" alt="Logo" width="130" class="me-2">
			</a>
			<div class="dropdown" [class.show]="dropdownOpen">
				<button class="btn btn-light d-flex align-items-center dropdown-toggle" type="button"
					(click)="dropdownOpen = !dropdownOpen" aria-expanded="dropdownOpen">
					<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
						class="bi bi-person-circle me-2" viewBox="0 0 16 16">
						<path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
						<path fill-rule="evenodd"
							d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1" />
					</svg>
					<span>{{ nombreUsuario }}</span>
				</button>
				<ul class="dropdown-menu dropdown-menu-end mt-2" [class.show]="dropdownOpen">
					<li><a class="dropdown-item" href="#" (click)="logout($event)">Cerrar sesión</a></li>
				</ul>
			</div>
		</div>
	</nav>
</header>
<div class="container mt-5">
	<div class="row justify-content-center">
		<div class="col-md-8">
			<div class="card p-4 card-shadow">
				<h3 class="text-center fw-bold my-3">Seleccionar comunidad</h3>
				<p class="text-center mb-4">Para acceder a la información específica de su comunidad</p>

				<div class="search-container mb-4">
					<div class="input-group position-relative">
						<input type="text" class="form-control" id="buscarComunidad" name="buscarComunidad"
							placeholder="Buscar comunidad..." [(ngModel)]="busqueda" (input)="filtrarComunidades()">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
							class="bi bi-geo-alt-fill position-absolute top-50 end-0 translate-middle-y me-3"
							viewBox="0 0 16 16">
							<path
								d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6" />
						</svg>
					</div>
				</div>

				<div class="d-flex justify-content-center mb-3">
					<ul class="nav nav-underline" id="comunidadTabs" role="tablist">
						<li class="nav-item" role="presentation">
							<button class="nav-link" [class.active]="tabActivo === 'mis'" (click)="cambiarTab('mis')"
								id="mis-comunidades-tab" type="button">Mis comunidades</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" [class.active]="tabActivo === 'explorar'"
								(click)="cambiarTab('explorar')" id="explorar-tab" type="button">Explorar
								comunidades</button>
						</li>
					</ul>
				</div>

				<div class="tab-content" id="comunidadTabsContent">
					<div class="tab-pane fade" [class.show]="tabActivo === 'mis'" [class.active]="tabActivo === 'mis'"
						id="mis-comunidades" role="tabpanel">
						<ng-container
							*ngIf="comunidadesFiltradas && comunidadesFiltradas.length > 0; else sinComunidades">
							<div *ngFor="let comunidad of comunidadesFiltradas" class="card mb-4">
								<div class="card-body d-flex justify-content-between align-items-center">
									<div class="d-flex align-items-center">
										<img src="default_image_community.png" alt="imgComunidad" id="community-image">
										<div class="card-content ms-4">
											<h5 class="card-title">{{ comunidad.nombre }}</h5>
											<p class="card-text text-muted">
												{{ comunidad.ciudad }}, {{ comunidad.estado }}
											</p>
										</div>
									</div>
									<div class="d-flex flex-column align-items-end">
										<button class="btn btn-danger btn-main"
											(click)="ingresarComunidad(comunidad)">Ingresar</button>
									</div>
								</div>
							</div>
						</ng-container>
						<ng-template #sinComunidades>
							<p class="text-muted text-center mt-3">Aún no se ha unido a ninguna comunidad.</p>
						</ng-template>
					</div>

					<div class="tab-pane fade" [class.show]="tabActivo === 'explorar'"
						[class.active]="tabActivo === 'explorar'" id="explorar" role="tabpanel">
						<ng-container *ngIf="comunidadesFiltradas.length > 0; else sinResultados">
							<div *ngFor="let comunidad of comunidadesFiltradas" class="card mb-4">
								<div class="card-body d-flex justify-content-between align-items-center">
									<div class="d-flex align-items-center">
										<img src="default_image_community.png" alt="imgComunidad" id="community-image">
										<div class="card-content ms-4">
											<h5 class="card-title">{{ comunidad.barrio }}</h5>
											<p class="card-text text-muted">
												<span *ngIf="comunidad.municipio">{{ comunidad.municipio }}</span>
												<span *ngIf="comunidad.departamento">{{ comunidad.municipio &&
													comunidad.departamento ? ', ' : '' }}{{ comunidad.departamento
													}}</span>
												<span *ngIf="comunidad.pais">{{ (comunidad.municipio ||
													comunidad.departamento) && comunidad.pais ? ', ' : '' }}{{
													comunidad.pais }}</span>
											</p>
										</div>
									</div>
									<div class="d-flex flex-column align-items-end">
										<button class="btn btn-success btn-main"
											(click)="unirseComunidad(comunidad)">Unirse</button>
									</div>
								</div>
							</div>
						</ng-container>
						<ng-template #sinResultados>
							<p class="text-muted text-center mt-3" *ngIf="busquedaRealizada">No se encontró ningún
								barrio.</p>
							<p class="text-muted text-center mt-3" *ngIf="!busquedaRealizada">Busque una comunidad para
								unirse.</p>
						</ng-template>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>